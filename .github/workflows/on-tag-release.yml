name: Tagged Release

on:
    release:
        types: [published]

jobs:
    add-artifacts-to-release:
        runs-on: ubuntu-24.04-arm
        permissions:
            contents: write
            actions: read
        env:
            FORCE_COLOR: 1
        steps:
            - uses: earthbuild/actions-setup@main
            - uses: actions/checkout@08c6903cd8c0fde910a37f88322edcfb5dd907a8  #v5.0.0
              with:
                token: ${{ secrets.GITHUB_TOKEN }}
                ref: ${{ github.event.release.tag_name }}
                fetch-depth: 0
            - name: Copy pre-built artifacts to release
              env:
                GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
                RELEASE_TAG: ${{ github.event.release.tag_name }}
              run: |
                earthly --ci --push --secret GITHUB_TOKEN=${{ env.GITHUB_TOKEN }} ./release+release-artifacts-to-gh \
                    --RELEASE_TAG=${{ env.RELEASE_TAG }}
