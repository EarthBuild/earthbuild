VERSION --allow-privileged-from-dockerfile 0.8
FROM alpine:3.18

privileged-context:
    RUN --privileged echo "hello dockerfile from privileged context" > a.txt
    SAVE ARTIFACT a.txt

test-allow-privileged-with-privileged-run-command:
    FROM DOCKERFILE --allow-privileged -f ./Dockerfile +privileged-context/*
    RUN --privileged ip link add dummy0 type dummy && ip link delete dummy0
    SAVE IMAGE test-allow-privileged-with-privileged-run-command:latest
